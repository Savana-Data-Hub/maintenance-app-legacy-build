webpackJsonp([10],{3686:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4982);n.d(t,"default",function(){return r.a})},3733:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){var n=function(n){function o(){return r(this,o),a(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return i(o,n),f(o,[{key:"componentDidMount",value:function(){var t=this;this.disposable=e.subscribe(function(e){return t.setState(e)},function(e){return u.a.error(e)})}},{key:"componentWillUnmount",value:function(){this.disposable&&this.disposable.unsubscribe&&this.disposable.unsubscribe()}},{key:"render",value:function(){return c.a.createElement(t,d({},this.state,this.props))}}]),o}(s.Component);return n.displayName=t.displayName||t.name,n}t.a=o;var s=n(0),c=n.n(s),l=n(40),u=n.n(l),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},4446:function(e,t,n){"use strict";function r(){}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},4935:function(e,t,n){"use strict";function r(){return i.a.createElement("div",null,i.a.createElement(o.a,null,"Access denied!"),i.a.createElement("p",null,"Unfortunately you do not have access to this functionality."))}t.a=r;var a=n(0),i=n.n(a),o=n(310)},4982:function(e,t,n){"use strict";function r(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(a,i){try{var o=t[a](i),s=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}return r("next")})}}function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){return e}function s(e,t){W.take(1).subscribe(function(r){var i=e.shiftKey,o=[],s=r.selectedLeft.filter(function(e){return e.id===t.id}).map(function(e){return e.id}),c=t.children.toArray(),l=[];if(i&&(l=c.filter(function(e){return r.selectedLeft.findIndex(function(t){return t.id===e.id})<0})),s.length>0)i&&s.push.apply(s,a(c.map(function(e){return e.id}))),o=r.selectedLeft.filter(function(e){return s.indexOf(e.id)<0});else{var u;o=(u=r.selectedLeft).concat.apply(u,[t].concat(a(l)))}n.i(E.c)({hierarchy:H({},r,{reload:[],selectedLeft:o})})})}function c(e,t){n.i(E.c)({hierarchy:H({},e,{isProcessing:t})})}function l(e){return W.take(1).combineLatest(D).flatMap(function(t){var n=B(t,2),r=n[0],a=n[1];e.parent={id:r.selectedRight[0]&&r.selectedRight[0].id};var i=e.save().then(function(){return a.i18n.getTranslation("successfully_moved_$$ouName$$",{ouName:e.displayName})}).catch(function(t){return a.i18n.getTranslation("failed_to_move_$$ouName$$_($$errorMessage$$)",{ouName:e.displayName,errorMessage:t})});return C.Observable.fromPromise(i)})}function u(){W.take(1).do(function(e){return c(e,!0)}).map(function(e){return(e.selectedLeft||[]).map(function(e){return e.id})}).flatMap(function(e){return C.Observable.fromPromise(q(e)).flatMap(o)}).map(l).concatAll().subscribe(function(e){U.a.show({message:e,translate:!1})},function(e){c(E.b.state.hierarchy,!1)},function(){n.i(E.c)({hierarchy:H({},E.b.state.hierarchy,{selectedLeft:[],selectedRight:[],initiallySelected:[],moveTargetPath:E.b.state.hierarchy.selectedRight[0].path,reload:[].concat(E.b.state.hierarchy.selectedRight.map(function(e){return e.id})).concat(E.b.state.hierarchy.selectedLeft.map(function(e){return e.parent&&e.parent.id?e.parent.id:E.b.state.hierarchy.leftRoots.concat(E.b.state.hierarchy.rightRoots).map(function(e){return e.id}).filter(function(t){return new RegExp(t).test(e.path)}).reduce(function(e){return e})}))})}),setTimeout(function(){c(E.b.state.hierarchy,!1)},0)})}function d(e,t){W.take(1).subscribe(function(e){return n.i(E.c)({hierarchy:H({},e,{reload:[],selectedRight:[t],moveTargetPath:null})})})}function f(e,t){var n={title:{color:"#666",marginBottom:".5rem"},message:{color:"#666",padding:".5rem",display:"block"},list:{paddingLeft:"1.5rem"}},r=e.organisationUnits.map(function(e){return v.a.createElement("li",{key:e.id},e.displayName)}),a=v.a.createElement("span",{style:n.message},t.d2.i18n.getTranslation(e.noOrganisationUnitsMessage));return v.a.createElement("div",{style:e.style},v.a.createElement("div",{style:n.title},t.d2.i18n.getTranslation(e.title)),r.length?v.a.createElement("ul",{style:n.list},r):a)}function p(e,t,n){return e.map(n).some(function(e){return t.map(n).indexOf(e)>=0})}function h(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split("/").filter(function(e){return e})}function m(e,t){if(e.some(function(e){return!e.path})||t.some(function(e){return!e.path}))return M.a.warn("No path found, so can not run hierarchy validation"),!0;if(1!==t.length)return M.a.warn("More than/less than 1 target found, can not move."),!0;var n=t[0];return e.some(function(e){return h(n.path).indexOf(e.id)>=0})}function y(e){return e.isProcessing||!e.selectedLeft.length||!e.selectedRight.length||p(e.selectedLeft,e.selectedRight,function(e){return e&&e.id})||m(e.selectedLeft,e.selectedRight)}function g(e,t){var n={wrap:{flex:1,display:"flex",flexOrientation:"row",margin:"1rem 0"},ouTreeLeft:{flex:1,marginRight:"2rem",padding:"1rem"},ouTreeRight:{flex:1,padding:"1rem"},moveButton:{width:"100%",marginBottom:"1rem",marginTop:"1rem"},pendingOperationsWrap:{padding:"1rem",margin:"1rem 0"},pendingOperationsListsWrap:{display:"flex",flexDirection:"row"},pendingOperationsList:{flex:1,padding:".5rem"},errorMessage:{color:"orange",lineHeight:"1.5rem",padding:"1rem 0",display:"flex",alignItems:"flex-end"},errorIcon:{color:"orange"}};if(!t.d2.currentUser.authorities.has("F_ORGANISATIONUNIT_MOVE"))return v.a.createElement(j.a,null);var r=t.d2.i18n.getTranslation("move_$$ouCount$$_organisation_units",{ouCount:e.selectedLeft&&e.selectedLeft.length||0}),i=t.d2.i18n.getTranslation("hierarchy_operations"),o=t.d2.i18n.getTranslation("you_can_not_move_higher_level_organisation_units_to_its_descendants"),c=e.moveTargetPath?[].concat(a(e.initiallyExpanded),[e.moveTargetPath]):e.initiallyExpanded;return v.a.createElement("div",null,v.a.createElement(k.a,null,i),v.a.createElement("div",{style:n.wrap},v.a.createElement(T.a,{style:n.ouTreeLeft},v.a.createElement(O.a,{roots:e.leftRoots,initiallyExpanded:e.initiallyExpanded,selected:e.selectedLeft.map(function(e){return e.path}),onSelectClick:s,onUpdateInput:function(e){return F(e)},idsThatShouldBeReloaded:e.reload,noHitsLabel:t.d2.i18n.getTranslation("no_matching_organisation_units"),forceReloadChildren:!0})),v.a.createElement(T.a,{style:n.ouTreeRight},v.a.createElement(O.a,{roots:e.rightRoots,selected:e.selectedRight.map(function(e){return e.path}),initiallyExpanded:c,onSelectClick:d,onUpdateInput:function(e){return V(e)},idsThatShouldBeReloaded:e.reload,noHitsLabel:t.d2.i18n.getTranslation("no_matching_organisation_units"),hideCheckboxes:!0,hideMemberCount:!0,forceReloadChildren:!0}))),v.a.createElement(T.a,{style:n.pendingOperationsWrap},v.a.createElement("div",{style:n.pendingOperationsListsWrap},v.a.createElement(G,{style:n.pendingOperationsList,organisationUnits:e.selectedLeft,noOrganisationUnitsMessage:"select_organisation_units_to_move_from_the_left_tree",title:"move"}),v.a.createElement(G,{style:n.pendingOperationsList,organisationUnits:e.selectedRight,noOrganisationUnitsMessage:"select_new_parent_for_organisation_units_from_the_right_tree",title:"new_parent"}))),e.selectedLeft.length&&e.selectedRight.length&&m(e.selectedLeft||[],e.selectedRight||[])?v.a.createElement("div",{style:n.errorMessage},v.a.createElement($.a,{style:n.errorIcon,className:"material-icons"},"warning"),o):null,v.a.createElement(w.a,{primary:!0,style:n.moveButton,label:r,onClick:u,disabled:y(e)}))}var b=n(0),v=n.n(b),_=n(312),T=n.n(_),O=n(4985),R=n(3733),E=n(315),P=n(128),x=n(205),w=n.n(x),S=n(109),L=n(26),C=(n.n(L),n(35)),U=(n.n(C),n(86)),k=n(310),A=n(4983),N=n(40),M=n.n(N),I=n(1652),$=n.n(I),j=n(4935),B=function(){function e(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},q=function(){var e=r(regeneratorRuntime.mark(function e(t){var r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.i(L.getInstance)();case 2:return r=e.sent,e.next=5,r.models.organisationUnit.list({filter:["id:in:["+t.join(",")+"]"],fields:":owner,href,id,parent,displayName,path,children[id,displayName,path]",paging:!1});case 5:return a=e.sent,e.abrupt("return",a.toArray());case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),D=C.Observable.fromPromise(n.i(L.getInstance)()),W=E.b.map(function(e){return e.hierarchy||{}}),V=P.a.create("rightTreeSearch","Hierarchy"),F=P.a.create("leftTreeSearch","Hierarchy");C.Observable.merge(F.map(function(e){return H({},e,{side:"left"})}).debounceTime(400),V.map(function(e){return H({},e,{side:"right"})}).debounceTime(400)).filter(function(e){return e.data}).map(function(e){var t=e.complete,r=e.error,a=e.data,i=e.side;return C.Observable.fromPromise(n.i(A.a)(a,50)).map(function(e){return{complete:t,error:r,organisationUnits:e,side:i}})}).concatAll().flatMap(function(e){return C.Observable.of(e).combineLatest(W.take(1),function(e,t){return{result:e,hierarchy:t}})}).subscribe(function(e){var t=e.result;e.hierarchy;n.i(E.c)({hierarchy:H({},E.b.state.hierarchy,i({},t.side+"Roots",t.organisationUnits))})}),C.Observable.merge(F.filter(function(e){return!e.data}).map(function(){return"left"}),V.filter(function(e){return!e.data}).map(function(){return"right"})).flatMap(function(e){return E.b.take(1).map(function(t){return{side:e,state:t}})}).subscribe(function(e){var t=e.side,r=e.state;n.i(E.c)({hierarchy:H({},r.hierarchy,i({},t+"Roots",r.userOrganisationUnits.toArray()))})});var z=E.b.map(function(e){var t=e.hierarchy,n=void 0===t?{}:t,r=e.userOrganisationUnits;return{roots:r.toArray(),leftRoots:n.leftRoots,rightRoots:n.rightRoots,initiallyExpanded:r.toArray().map(function(e){return e.path}),moveTargetPath:n.moveTargetPath||null,selectedLeft:n.selectedLeft||[],selectedRight:n.selectedRight||[],isProcessing:n.isProcessing,reload:n.reload}});f.defaultProps={organisationUnits:[]};var G=n.i(S.a)(f);g.defaultProps={selectedLeft:[],selectedRight:[]},t.a=n.i(R.a)(z,n.i(S.a)(g))},4983:function(e,t,n){"use strict";function r(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(a,i){try{var o=t[a](i),s=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}return r("next")})}}var a=n(26),i=(n.n(a),n(315));t.a=function(){function e(e){return t.apply(this,arguments)}var t=r(regeneratorRuntime.mark(function e(t){var r,o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.i(a.getInstance)();case 2:if(r=e.sent,t.trim().length){e.next=5;break}return e.abrupt("return",i.b.getState().userOrganisationUnits.toArray().map(function(e){return r.models.organisationUnits.create({id:e.id,path:e.path,displayName:e.displayName})}));case 5:return e.next=7,r.models.organisationUnits.list({fields:"id,displayName,path,children::isNotEmpty,access",query:t,withinUserHierarchy:!0,pageSize:s});case 7:return o=e.sent,e.abrupt("return",o.toArray());case 9:case"end":return e.stop()}},e,this)}));return e}()},4985:function(e,t,n){"use strict";function r(e,t){var n={labelStyle:{whiteSpace:"nowrap"},noHitsLabel:{fontStyle:"italic",color:"rgba(0, 0, 0, 0.4)"}};return i.a.createElement("div",{style:{position:"relative"}},i.a.createElement(s.a,{hintText:t.d2.i18n.getTranslation("search"),onUpdateInput:e.onUpdateInput,onNewRequest:e.onAutoCompleteValueSelected,dataSource:e.autoCompleteDataSource,filter:s.a.noFilter}),Array.isArray(e.roots)&&e.roots.length>0?e.roots.map(function(t){return i.a.createElement(c.a,{key:t.id,root:t,selected:e.selected,initiallyExpanded:e.initiallyExpanded,labelStyle:n.labelStyle,onSelectClick:e.onSelectClick,idsThatShouldBeReloaded:e.idsThatShouldBeReloaded,hideCheckboxes:e.hideCheckboxes,hideMemberCount:e.hideMemberCount,forceReloadChildren:e.forceReloadChildren})}):i.a.createElement("div",{style:n.noHitsLabel},e.noHitsLabel))}var a=n(0),i=n.n(a),o=n(1721),s=n.n(o),c=n(1720),l=n(109),u=n(4446),d=n.n(u);r.propTypes={onOrgUnitSearch:i.a.PropTypes.func,onNewRequest:i.a.PropTypes.func,autoCompleteDataSource:i.a.PropTypes.array,onChangeSelectedOrgUnit:i.a.PropTypes.func,onAutoCompleteValueSelected:i.a.PropTypes.func,searchOrganisationUnits:i.a.PropTypes.func,roots:i.a.PropTypes.array,idsThatShouldBeReloaded:i.a.PropTypes.array,onUpdateInput:i.a.PropTypes.func,selected:i.a.PropTypes.array,initiallyExpanded:i.a.PropTypes.array,onSelectClick:i.a.PropTypes.func,noHitsLabel:i.a.PropTypes.string.isRequired,hideMemberCount:i.a.PropTypes.bool,hideCheckboxes:i.a.PropTypes.bool},r.defaultProps={onOrgUnitSearch:d.a,onNewRequest:d.a,onChangeSelectedOrgUnit:d.a,onAutoCompleteValueSelected:d.a,searchOrganisationUnits:d.a,onUpdateInput:d.a,initiallyExpanded:[],roots:[],autoCompleteDataSource:[],idsThatShouldBeReloaded:[],onClick:d.a,hideMemberCount:!1,hideCheckboxes:!1},t.a=n.i(l.a)(r)}});
//# sourceMappingURL=10-6c7fdf65414f50ce6020.js.map